#!/bin/bash

# ==============================================
# PART 1: –ü–†–û–ë–ê –ü–ï–†–ê
# ==============================================
# –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –æ–¥–Ω–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º.
# –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä - —á–∏—Å–ª–æ, —Ç–æ –æ—à–∏–±–∫–∞.
# –ò–Ω–∞—á–µ –≤—ã–≤–æ–¥–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.
# ==============================================

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—â—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
source "$SCRIPT_DIR/lib/common.sh"

# –û—á–∏—â–∞–µ–º —ç–∫—Ä–∞–Ω –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
clear

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
echo -e "${BOLD}${BG_BLACK}${TEXT_GREEN}PART 1: –ü–†–û–ë–ê –ü–ï–†–ê${RESET}"
print_separator "="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
if ! check_params_count $# 1; then
    echo -e "\n${BOLD}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:${RESET} $0 <—Ç–µ–∫—Å—Ç–æ–≤—ã–π_–ø–∞—Ä–∞–º–µ—Ç—Ä>"
    echo -e "${ITALIC}–ü—Ä–∏–º–µ—Ä:${RESET} $0 \"–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!\""
    exit 1
fi

# –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä
param="$1"

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä —á–∏—Å–ª–æ–º
if is_number "$param"; then
    log_error "–ü–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º!"
    echo -e "\n${BOLD}–ü–æ—è—Å–Ω–µ–Ω–∏–µ:${RESET} –°–∫—Ä–∏–ø—Ç –æ–∂–∏–¥–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∞ –ø–æ–ª—É—á–µ–Ω–æ —á–∏—Å–ª–æ."
    exit 1
fi

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
echo -e "\n${BOLD}${TEXT_GREEN}‚úì –£–°–ü–ï–•${RESET}"
print_separator "-"
echo -e "${BOLD}–ü–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä:${RESET} ${TEXT_PURPLE}$param${RESET}"
print_separator "-"

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
echo -e "\n${ITALIC}–¢–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:${RESET} $(file -b <<< "$param" 2>/dev/null || echo "—Ç–µ–∫—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞")"
echo -e "${ITALIC}–î–ª–∏–Ω–∞:${RESET} ${#param} —Å–∏–º–≤–æ–ª–æ–≤"

# –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —á–∞—Å—Ç–µ–π
echo -e "\n${BG_BLUE}${TEXT_WHITE}üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞${RESET} –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Å —á–∏—Å–ª–æ–º, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏."

# –í–µ—Ä–¥–∏–∫—Ç –ø–æ –ø–∞–º—è—Ç–∏ (–∏–∑ CRAFT)
echo
free_percent=$(get_memory_status 2>/dev/null || echo 85)
echo -e "${ITALIC}$(memory_verdict "$free_percent")${RESET}"

exit 0
